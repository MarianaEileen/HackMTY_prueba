<div class="max-w-md mx-auto">
  <div class="bg-white p-6 rounded-lg shadow-md text-center">
    <h2 class="text-xl font-semibold text-slate-800 mb-4">Expiry Date Scanner</h2>

    @if (!isScanning()) {
      <button (click)="startScan()" class="w-full flex items-center justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-sky-600 hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
        Start Scanning
      </button>
    } @else {
      <button (click)="stopScan()" class="w-full flex items-center justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        Stop Scanning
      </button>
    }

    @if (scanError()) {
      <p class="mt-4 text-sm text-red-600">{{ scanError() }}</p>
    }
    
    <div class="mt-4 relative" [class.hidden]="!isScanning()">
      <video #video class="w-full rounded-lg" playsinline></video>
      <canvas #canvas class="hidden"></canvas>
      <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
        <div class="w-3/4 h-1/2 border-4 border-dashed border-white/50 rounded-lg"></div>
      </div>
    </div>
  </div>
  
  @if (productStatus()) {
    <div class="mt-6 bg-white p-6 rounded-lg shadow-md">
      @if (scanResult(); as result) {
        <h3 class="text-lg font-medium text-slate-900 mb-3 text-center">Scan Result</h3>
        <div class="space-y-2 text-left">
          <p><strong class="font-semibold text-slate-600">Product:</strong> <span class="text-slate-800">{{ result.name }}</span></p>
          <p><strong class="font-semibold text-slate-600">ID:</strong> <span class="text-slate-800">{{ result.productId }}</span></p>
          <p><strong class="font-semibold text-slate-600">Expiry Date:</strong> <span class="text-slate-800">{{ result.expiryDate }}</span></p>
        </div>
      }

      @switch (productStatus()) {
        @case ('ok') {
          <div class="mt-4 p-4 rounded-lg bg-green-100 text-green-800 text-center">
            <p class="font-bold text-lg">Product OK</p>
            <p class="text-sm">In good condition.</p>
          </div>
        }
        @case ('nearing_expiry') {
          <div class="mt-4 p-4 rounded-lg bg-yellow-100 text-yellow-800 text-center">
            <p class="font-bold text-lg">Nearing Expiry</p>
            <p class="text-sm">Prioritize for use.</p>
          </div>
        }
        @case ('expired') {
          <div class="mt-4 p-4 rounded-lg bg-red-100 text-red-800 text-center">
            <p class="font-bold text-lg">Expired</p>
            <p class="text-sm">Do not use. Dispose of properly.</p>
          </div>
        }
        @case ('invalid') {
          <div class="mt-4 p-4 rounded-lg bg-red-100 text-red-800 text-center">
            <p class="font-bold text-lg">Invalid QR Code</p>
            <p class="text-sm">Data not in a recognized format. Please use product JSON or a simple date.</p>
          </div>
        }
      }
    </div>
  }
</div>